{# Copyright (C) 2017 Maciej Delmanowski <drybjed@gmail.com>
 # Copyright (C) 2017 DebOps <https://debops.org/>
 # SPDX-License-Identifier: GPL-3.0-only
 #}
{% set rabbitmq_server__tpl_accounts_vhosts = [] %}
{% for account in lookup("flattened", rabbitmq_server__combined_accounts) %}
{%   if account.vhost|d() and account.state|d('present') != 'absent' %}
{%     set _ = rabbitmq_server__tpl_accounts_vhosts.append({
   'name': account.vhost,
   'node': account.node|d(omit),
   'tracing': account.tracing|d(omit)
}) %}
{%   endif %}
{% endfor %}
{{ rabbitmq_server__tpl_accounts_vhosts }}
